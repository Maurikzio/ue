<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyecto</title>
  <link rel="stylesheet" href="../styles/styles.css">
  <link rel="stylesheet" href="../styles/project.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="back-container">
    <a href="../index.html" class="back-link">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
      <span>Atrás</span>
    </a>
  </div>
  <div class="container">
    <section class="project-image">
      <div class="overlay">
        <button id="prevBtn">≪</button>
        <button id="nextBtn">≫</button>
      </div>
      <img src="../assets/tech-learn.jpg" alt="TechLearn" id="project-image">
    </section>
    <section class="project-info">
      <h1>TechLearn: Educación para todos</h1>
      <div class="owner-info">
        <span>Por: Juan Fernandez</span>
        •
        <span>Quito - Ecuador</span>
        •
        <span>Educación Para Todos</span>
      </div>
      <div>
        <progress max="100" value="45">45%</progress>
      </div>
      <div class="stats-info">
        <div>
          <p>$ <span id="collected">37,500</span></p>
          <p>reacaudados de $ <span id="total">50,000</span></p>
        </div>
        <div>
          <p><span id="funded">37</span> %</p>
          <p>financiado</p>
        </div>
        <div class="time-info">
          <div>
            <p>15</p>
            <p>días restantes</p>
          </div>
          <div id="time-remaining">48 horas
            59 minutos
            59 segundos
          </div>
        </div>
      </div>
      <div class="project-contribute">
        <div class="actions">
          <div class="field">
            <label for="">$</label>
            <input type="number" placeholder="10" />
          </div>
          <button class="btn btn-primary">Contribuir al proyecto</button>
        </div>
        <p id="contribution-message"></p>
      </div>
      <div class="project-about">
        <h2>Sobre el proyecto</h2>
        <p>
          Plataforma educativa innovadora que busca democratizar el acceso a la educación tecnológica. Ofrecemos cursos
          interactivos de programación, diseño web, inteligencia artificial y otras tecnologías emergentes. Nuestro
          enfoque se centra en materiales de alta calidad, mentores expertos y una metodología práctica que se adapta al
          ritmo de cada estudiante. La plataforma incluye herramientas de aprendizaje personalizado, proyectos reales y
          una comunidad activa de estudiantes y profesionales. Creemos que la educación tecnológica de calidad debe
          estar al alcance de todos, independientemente de su ubicación o recursos económicos.
        </p>
      </div>
    </section>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {

      function formatNumber(number) {
        return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }

      function removeCommas(str) {
        return str.replace(/,/g, '');
      }

      function showMessage(message) {
        const messageField = document.getElementById('contribution-message');
        messageField.textContent = message;
      }

      const contributeBtn = document.querySelector('.project-contribute button');

      function updateValues(contribution) {
        const progressBar = document.querySelector('progress');
        const collected = document.getElementById('collected');
        const total = document.getElementById('total');
        const funded = document.getElementById('funded');

        const currentCollected = parseInt(removeCommas(collected.textContent));
        const totalGoal = parseInt(removeCommas(total.textContent));

        let newCollected = currentCollected + contribution;
        const difference = totalGoal - newCollected;

        if (difference === 0) {
          showMessage("Hemos alcanzado exactamente la meta del proyecto. \n Gracias por tu contribución!");
          contributeBtn.disabled = true;
          clearInterval(clockInterval);
        } else if (difference < 0) {
          const excess = Math.abs(difference);
          const actualContribution = contribution - excess;
          newCollected = totalGoal;

          showMessage(`La meta del proyecto es: ${formatNumber(totalGoal)},
            Tu contribución de $${formatNumber(contribution)} excede la meta por $${formatNumber(excess)}.
            Aceptaremos solamente $${formatNumber(actualContribution)}.
            Gracias por tu contribución!
          `);
          contributeBtn.disabled = true;
          clearInterval(clockInterval);
        }

        const newPercentage = Math.round((newCollected / totalGoal) * 100);

        progressBar.value = newPercentage;
        collected.textContent = formatNumber(newCollected);
        funded.textContent = newPercentage;

        if (newPercentage >= 100) {
          contributeBtn.disabled = true;
          contributeBtn.textContent = "Meta alcanzada!"
        }
      }


      contributeBtn.addEventListener('click', function () {
        const input = document.querySelector('.project-contribute input');
        const contributeAmount = parseInt(input.value);

        if (!contributeAmount || contributeAmount <= 0) {
          alert('Por favor ingresa una cantidad valida');
          return;
        }

        updateValues(contributeAmount);

        input.value = '';
      })


      // Carousel de imagenes
      const images = [
        "../assets/tech-learn.jpg",
        "../assets/eco-harvest.jpg",
        "../assets/hero-bg.jpg",
        "../assets/kids-code.jpg",
        "../assets/sound-lab.jpg"
      ];
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      let currentIndex = 0;

      function changeImage(currentIdx) {
        const projectImage = document.getElementById('project-image');
        const currentImage = images[currentIdx];
        projectImage.setAttribute('src', currentImage);
      }

      prevBtn.addEventListener('click', function () {
        if (currentIndex === 0) {
          return
        }
        currentIndex -= 1;
        changeImage(currentIndex);
      });

      nextBtn.addEventListener('click', function () {
        if (currentIndex === images.length - 1) {
          return
        }
        currentIndex += 1;
        changeImage(currentIndex);
      });

      const timeElement = document.getElementById('time-remaining');
      function getTimeRemaining(endTime) {
        const total = Date.parse(endTime) - Date.parse(new Date());
        const seconds = Math.floor((total / 1000) % 60);
        const minutes = Math.floor((total / 1000 / 60) % 60);
        const hours = Math.floor((total / (1000 * 60 * 60)));

        return { total, seconds, minutes, hours }
      }

      function initClock(daysRemaining) {
        const endTime = new Date(Date.now() + daysRemaining * 24 * 60 * 60 * 1000);

        function updateClock() {
          const rT = getTimeRemaining(endTime);

          if (rT.total <= 0) {
            clearInterval(timeInterval)
            return;
          }

          timeElement.textContent = `${rT.hours} horas
          ${rT.minutes} minutos
          ${rT.seconds} segundos
          `;

        }
        updateClock();
        const timeInterval = setInterval(updateClock, 1000);
        return timeInterval;
      }

      const clockInterval = initClock(2)
    })
  </script>
</body>

</html>